# Google Cloud Run Reporter-Agent ç›‘æ§è„šæœ¬ä½¿ç”¨è¯´æ˜

## æ¦‚è¿°

`monitor_reporter_agent.sh` æ˜¯ä¸€ä¸ªå…¨é¢çš„ Google Cloud Run `reporter-agent` æœåŠ¡ç›‘æ§å·¥å…·ï¼Œæä¾›å®æ—¶çŠ¶æ€ç›‘æ§ã€æ—¥å¿—æŸ¥çœ‹ã€æ€§èƒ½æŒ‡æ ‡å’Œä»»åŠ¡æ‰§è¡ŒçŠ¶æ€è·Ÿè¸ªã€‚

## åŠŸèƒ½ç‰¹æ€§

### ğŸ” ç›‘æ§åŠŸèƒ½
- **æœåŠ¡çŠ¶æ€**: æ£€æŸ¥ Cloud Run æœåŠ¡å’Œ HTTP å¥åº·çŠ¶æ€
- **è¯¦ç»†å¥åº·**: è·å–æœåŠ¡è¯¦ç»†ä¿¡æ¯ï¼ˆç‰ˆæœ¬ã€è¿è¡Œæ—¶é—´ã€æ´»åŠ¨ä»»åŠ¡ï¼‰
- **ä»»åŠ¡çŠ¶æ€**: æŸ¥çœ‹å½“å‰å’Œå†å²ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€
- **æ€§èƒ½æŒ‡æ ‡**: ç›‘æ§å†…å­˜ä½¿ç”¨ã€CPU é…ç½®å’Œè¯·æ±‚æ´»åŠ¨
- **æ—¥å¿—ç›‘æ§**: æŸ¥çœ‹æœ€è¿‘æ—¥å¿—ã€é”™è¯¯æ—¥å¿—å’Œå®æ—¶è¿½è¸ª

### ğŸ› ï¸ å·¥å…·åŠŸèƒ½
- **å®æ—¶ç›‘æ§**: æŒç»­ç›‘æ§æœåŠ¡çŠ¶æ€å’Œæ—¥å¿—
- **æ—¥å¿—è¿½è¸ª**: ç±»ä¼¼ `tail -f` çš„å®æ—¶æ—¥å¿—æµ
- **è°ƒåº¦å™¨çŠ¶æ€**: æŸ¥çœ‹å…³è”çš„ Cloud Scheduler çŠ¶æ€
- **å®Œæ•´æŠ¥å‘Š**: ç”Ÿæˆç»¼åˆç›‘æ§æŠ¥å‘Š

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬å‘½ä»¤

```bash
# æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯
./monitor_reporter_agent.sh help

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
./monitor_reporter_agent.sh status

# æ£€æŸ¥è¯¦ç»†å¥åº·çŠ¶æ€
./monitor_reporter_agent.sh health

# æŸ¥çœ‹ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€
./monitor_reporter_agent.sh tasks

# æŸ¥çœ‹æ€§èƒ½æŒ‡æ ‡
./monitor_reporter_agent.sh metrics

# æŸ¥çœ‹æœ€è¿‘æ—¥å¿—
./monitor_reporter_agent.sh logs

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
./monitor_reporter_agent.sh errors

# æŸ¥çœ‹è°ƒåº¦å™¨çŠ¶æ€
./monitor_reporter_agent.sh scheduler
```

### é«˜çº§åŠŸèƒ½

```bash
# å®æ—¶ç›‘æ§æœåŠ¡ï¼ˆæ¯5ç§’åˆ·æ–°ï¼‰
./monitor_reporter_agent.sh watch

# æŒç»­ç›‘æ§æ—¥å¿—ï¼ˆæ¯5ç§’åˆ·æ–°ï¼‰
./monitor_reporter_agent.sh logs-watch

# å®æ—¶è¿½è¸ªæ—¥å¿—ï¼ˆç±»ä¼¼ tail -fï¼‰
./monitor_reporter_agent.sh tail

# æ˜¾ç¤ºå®Œæ•´ç›‘æ§æŠ¥å‘Š
./monitor_reporter_agent.sh all
```

## è¾“å‡ºç¤ºä¾‹

### æœåŠ¡çŠ¶æ€
```
ğŸ” æ­£åœ¨æ£€æŸ¥æœåŠ¡çŠ¶æ€...
âœ… Cloud Run æœåŠ¡çŠ¶æ€: æ­£å¸¸
   æœåŠ¡URL: https://reporter-agent-472712465571.asia-southeast1.run.app
âœ… HTTP å¥åº·æ£€æŸ¥: æ­£å¸¸
```

### è¯¦ç»†å¥åº·çŠ¶æ€
```
ğŸ¥ è·å–è¯¦ç»†å¥åº·çŠ¶æ€...
æœåŠ¡ä¿¡æ¯:
  æœåŠ¡åç§°: reporter-agent
  çŠ¶æ€: running
  ç‰ˆæœ¬: 2.1.0
  è¿è¡Œæ—¶é—´: 2871åˆ†é’Ÿ
  æ´»åŠ¨ä»»åŠ¡: 0ä¸ª
  æœ€åå¥åº·æ£€æŸ¥: 2025-07-09T08:39:19.979133
```

### ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€
```
ğŸ“Š è·å–ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€...
æœ€è¿‘ä»»åŠ¡:
  æ€»ä»»åŠ¡æ•°: 2
  ä»»åŠ¡ID: task_1751932800_6771
  çŠ¶æ€: completed
  è¿›åº¦: Task completed successfully
  ---
  ä»»åŠ¡ID: task_1751850504_1000
  çŠ¶æ€: failed
  è¿›åº¦: Task timed out
```

### æ€§èƒ½æŒ‡æ ‡
```
ğŸ“ˆ è·å–æ€§èƒ½æŒ‡æ ‡...
å†…å­˜é…ç½®:
  32Gi
æœ€è¿‘è¯·æ±‚æ´»åŠ¨:
  GET   200     2025-07-09T00:40:48.112722Z
  POST  200     2025-07-09T00:36:09.071796Z
  GET   200     2025-07-09T00:35:01.464791Z
```

### è°ƒåº¦å™¨çŠ¶æ€
```
â° è·å–äº‘è°ƒåº¦å™¨çŠ¶æ€...
STATE    SCHEDULE   TIME_ZONE       URI
ENABLED  0 8 * * *  Asia/Singapore  https://reporter-agent-472712465571.asia-southeast1.run.app/run
```

## å¸¸è§ä½¿ç”¨åœºæ™¯

### 1. æ—¥å¸¸ç›‘æ§
å¿«é€Ÿæ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œï¼š
```bash
./monitor_reporter_agent.sh status
```

### 2. ä»»åŠ¡ç›‘æ§
æ£€æŸ¥å®šæ—¶ä»»åŠ¡æ‰§è¡Œæƒ…å†µï¼š
```bash
./monitor_reporter_agent.sh tasks
```

### 3. é—®é¢˜æ’æŸ¥
å½“å‘ç°æœåŠ¡å¼‚å¸¸æ—¶ï¼š
```bash
# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
./monitor_reporter_agent.sh errors

# æŸ¥çœ‹è¯¦ç»†å¥åº·çŠ¶æ€
./monitor_reporter_agent.sh health

# æŸ¥çœ‹æœ€è¿‘æ—¥å¿—
./monitor_reporter_agent.sh logs
```

### 4. æ€§èƒ½åˆ†æ
ç›‘æ§æœåŠ¡æ€§èƒ½å’Œèµ„æºä½¿ç”¨ï¼š
```bash
./monitor_reporter_agent.sh metrics
```

### 5. å®æ—¶ç›‘æ§
åœ¨å…³é”®æ—¶æœŸè¿›è¡Œå®æ—¶ç›‘æ§ï¼š
```bash
# å®æ—¶ç›‘æ§æœåŠ¡çŠ¶æ€
./monitor_reporter_agent.sh watch

# å®æ—¶è¿½è¸ªæ—¥å¿—
./monitor_reporter_agent.sh tail
```

### 6. è°ƒåº¦å™¨æ£€æŸ¥
æ£€æŸ¥å…³è”çš„ Cloud Scheduler çŠ¶æ€ï¼š
```bash
./monitor_reporter_agent.sh scheduler
```

### 7. å®Œæ•´æŠ¥å‘Š
ç”Ÿæˆç»¼åˆç›‘æ§æŠ¥å‘Šï¼š
```bash
./monitor_reporter_agent.sh all
```

## é…ç½®è¯´æ˜

è„šæœ¬ä¸­çš„å…³é”®é…ç½®å‚æ•°ï¼š

```bash
PROJECT_ID="solar-idea-463423-h8"           # GCP é¡¹ç›®ID
SERVICE_NAME="reporter-agent"              # Cloud Run æœåŠ¡åç§°
REGION="asia-southeast1"                   # éƒ¨ç½²åŒºåŸŸ
SERVICE_URL="https://reporter-agent-472712465571.asia-southeast1.run.app"  # æœåŠ¡URL
```

## ç›‘æ§æŒ‡æ ‡è§£é‡Š

### æœåŠ¡çŠ¶æ€
- **Cloud Run æœåŠ¡çŠ¶æ€**: æœåŠ¡æ˜¯å¦æ­£å¸¸éƒ¨ç½²å’Œè¿è¡Œ
- **HTTP å¥åº·æ£€æŸ¥**: `/health` ç«¯ç‚¹æ˜¯å¦è¿”å› 200 çŠ¶æ€ç 

### å¥åº·çŠ¶æ€è¯¦æƒ…
- **æœåŠ¡åç§°**: Cloud Run æœåŠ¡åç§°
- **çŠ¶æ€**: æœåŠ¡å½“å‰çŠ¶æ€ï¼ˆrunning/stopped/errorï¼‰
- **ç‰ˆæœ¬**: æœåŠ¡ç‰ˆæœ¬å·
- **è¿è¡Œæ—¶é—´**: æœåŠ¡è¿ç»­è¿è¡Œæ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰
- **æ´»åŠ¨ä»»åŠ¡**: å½“å‰æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡æ•°é‡
- **æœ€åå¥åº·æ£€æŸ¥**: æœ€åä¸€æ¬¡å¥åº·æ£€æŸ¥çš„æ—¶é—´æˆ³

### ä»»åŠ¡çŠ¶æ€
- **ä»»åŠ¡ID**: å”¯ä¸€ä»»åŠ¡æ ‡è¯†ç¬¦
- **çŠ¶æ€**: ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€ï¼ˆrunning/completed/failedï¼‰
- **è¿›åº¦**: ä»»åŠ¡å½“å‰è¿›åº¦æˆ–é”™è¯¯ä¿¡æ¯

### æ€§èƒ½æŒ‡æ ‡
- **å†…å­˜é…ç½®**: Cloud Run æœåŠ¡åˆ†é…çš„å†…å­˜å¤§å°
- **æœ€è¿‘è¯·æ±‚æ´»åŠ¨**: æœ€è¿‘çš„ HTTP è¯·æ±‚è®°å½•ï¼ˆæ–¹æ³•ã€çŠ¶æ€ç ã€æ—¶é—´ï¼‰

## å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### 1. æœåŠ¡çŠ¶æ€å¼‚å¸¸
**ç—‡çŠ¶**: `âŒ Cloud Run æœåŠ¡çŠ¶æ€: å¼‚å¸¸`
**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£ç¡®éƒ¨ç½²
- ç¡®è®¤æœåŠ¡é…ç½®å’Œèµ„æºåˆ†é…
- æŸ¥çœ‹ Cloud Run æ§åˆ¶å°é”™è¯¯ä¿¡æ¯

### 2. HTTP å¥åº·æ£€æŸ¥å¤±è´¥
**ç—‡çŠ¶**: `âŒ HTTP å¥åº·æ£€æŸ¥: å¼‚å¸¸`
**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£åœ¨å¯åŠ¨ä¸­
- ç¡®è®¤ `/health` ç«¯ç‚¹æ˜¯å¦æ­£å¸¸å·¥ä½œ
- æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œé˜²ç«å¢™è®¾ç½®

### 3. ä»»åŠ¡è¶…æ—¶
**ç—‡çŠ¶**: ä»»åŠ¡çŠ¶æ€æ˜¾ç¤º "Task timed out"
**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥ä»»åŠ¡å¤„ç†çš„æ•°æ®é‡æ˜¯å¦è¿‡å¤§
- è€ƒè™‘å¢åŠ  Cloud Run çš„è¶…æ—¶è®¾ç½®
- ä¼˜åŒ–æ•°æ®å¤„ç†é€»è¾‘ä»¥æé«˜æ•ˆç‡

### 4. å†…å­˜ä¸è¶³
**ç—‡çŠ¶**: æœåŠ¡é¢‘ç¹é‡å¯æˆ–ä»»åŠ¡å¤±è´¥
**è§£å†³æ–¹æ¡ˆ**:
- ç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µ
- è€ƒè™‘å¢åŠ  Cloud Run çš„å†…å­˜é…ç½®
- ä¼˜åŒ–ä»£ç ä»¥å‡å°‘å†…å­˜ä½¿ç”¨

## ç³»ç»Ÿè¦æ±‚

- `gcloud` CLI å·¥å…·å·²å®‰è£…å¹¶è®¤è¯
- `curl` å‘½ä»¤å¯ç”¨
- å¯¹ GCP é¡¹ç›®æœ‰é€‚å½“çš„æƒé™ï¼ˆCloud Run Viewer, Logging Viewerï¼‰

## ç›¸å…³è„šæœ¬

- `monitor_google_scheduler.sh` - Google Cloud Scheduler ç›‘æ§
- `debug_scheduler.sh` - è°ƒåº¦å™¨é—®é¢˜è¯Šæ–­
- `deploy_reporter_agent.sh` - æœåŠ¡éƒ¨ç½²è„šæœ¬
- `setup_reporter_agent_monitoring.sh` - ç›‘æ§å‘Šè­¦è®¾ç½®

## æœ€ä½³å®è·µ

1. **å®šæœŸæ£€æŸ¥**: æ¯å¤©è¿è¡Œ `./monitor_reporter_agent.sh status` æ£€æŸ¥æœåŠ¡çŠ¶æ€
2. **ä»»åŠ¡ç›‘æ§**: å®šæ—¶ä»»åŠ¡æ‰§è¡Œåè¿è¡Œ `./monitor_reporter_agent.sh tasks` æ£€æŸ¥æ‰§è¡Œç»“æœ
3. **æ€§èƒ½ç›‘æ§**: å®šæœŸè¿è¡Œ `./monitor_reporter_agent.sh metrics` ç›‘æ§æ€§èƒ½æŒ‡æ ‡
4. **é—®é¢˜æ’æŸ¥**: å‘ç°å¼‚å¸¸æ—¶ç«‹å³è¿è¡Œ `./monitor_reporter_agent.sh errors` æŸ¥çœ‹é”™è¯¯
5. **å®æ—¶ç›‘æ§**: åœ¨å…³é”®æ—¶æœŸä½¿ç”¨ `./monitor_reporter_agent.sh watch` è¿›è¡Œå®æ—¶ç›‘æ§

## æ›´æ–°æ—¥å¿—

- **v1.0**: åˆå§‹ç‰ˆæœ¬ï¼Œæ”¯æŒåŸºæœ¬æœåŠ¡ç›‘æ§
- **v1.1**: å¢åŠ ä»»åŠ¡çŠ¶æ€ç›‘æ§å’Œæ€§èƒ½æŒ‡æ ‡
- **v1.2**: å¢åŠ å®æ—¶æ—¥å¿—è¿½è¸ªåŠŸèƒ½
- **v1.3**: å¢åŠ è°ƒåº¦å™¨çŠ¶æ€ç›‘æ§å’Œå®Œæ•´æŠ¥å‘ŠåŠŸèƒ½ 
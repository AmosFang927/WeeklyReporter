# WeeklyReporter - Involve Asiaæ•°æ®å¤„ç†å·¥å…·

# TODO

# postback - database
# IA postback (receive)
# at postback
# cary postback (sent postback)

# linkshare api
# bytec domain
# rta

curl -s "https://bytec-public-postback-crwdeesavq-as.a.run.app/docs" | head -20

ByteC2024PostBack_CloudSQL_20250708


ğŸš€ **è‡ªåŠ¨åŒ–çš„å‘¨æŠ¥ç”Ÿæˆå’Œåˆ†å‘ç³»ç»Ÿ**

### âš¡ å¼‚æ­¥I/Oæ€§èƒ½å¢å¼º

æœ€æ–°v2.1.0ç‰ˆæœ¬é›†æˆäº†é«˜æ€§èƒ½å¼‚æ­¥APIå®¢æˆ·ç«¯ï¼Œå¤§å¹…æå‡æ•°æ®è·å–æ•ˆç‡ï¼š

- **3-5å€æ€§èƒ½æå‡**: å¹¶å‘åˆ†é¡µè¯·æ±‚æ˜¾è‘—å‡å°‘APIè°ƒç”¨æ€»æ—¶é—´
- **æ™ºèƒ½å¹¶å‘æ§åˆ¶**: æ ¹æ®æ•°æ®é‡è‡ªåŠ¨è°ƒæ•´å¹¶å‘æ•°ï¼Œé¿å…APIé™æµ
- **å®Œå…¨å‘åå…¼å®¹**: æ— éœ€ä¿®æ”¹ç°æœ‰é…ç½®ï¼Œå¯é€‰æ‹©æ€§å¯ç”¨å¼‚æ­¥æ¨¡å¼
- **ä¸€é”®æ€§èƒ½æµ‹è¯•**: å†…ç½®åŒæ­¥vså¼‚æ­¥æ€§èƒ½å¯¹æ¯”å·¥å…·

## âœ¨ åŠŸèƒ½ç‰¹ç‚¹

- **ğŸ”„ è‡ªåŠ¨æ•°æ®è·å–**: ä» Involve Asia API è·å–è½¬æ¢æ•°æ®
- **âš¡ å¼‚æ­¥I/OåŠ é€Ÿ**: ä½¿ç”¨å¼‚æ­¥å¹¶å‘è¯·æ±‚ï¼Œæ˜¾è‘—æå‡APIæ•°æ®è·å–æ€§èƒ½
- **ğŸ“Š æ™ºèƒ½æ•°æ®å¤„ç†**: è‡ªåŠ¨æ¸…æ´—ã€åˆ†ç±»å’Œæ ¼å¼åŒ–æ•°æ®
- **ğŸ“ˆ å¤šæ ¼å¼æŠ¥å‘Š**: ç”ŸæˆExcelæ ¼å¼çš„è¯¦ç»†æŠ¥å‘Š
- **ğŸ“§ è‡ªåŠ¨é‚®ä»¶å‘é€**: æ”¯æŒæŒ‰Partneråˆ†åˆ«å‘é€å®šåˆ¶æŠ¥å‘Š
- **â˜ï¸ é£ä¹¦äº‘æ–‡æ¡£**: è‡ªåŠ¨ä¸Šä¼ æŠ¥å‘Šåˆ°é£ä¹¦Sheet
- **â° å®šæ—¶ä»»åŠ¡**: æ”¯æŒæ¯æ—¥è‡ªåŠ¨æ‰§è¡Œ
- **ğŸ¯ å¤šPartneræ”¯æŒ**: æ”¯æŒRAMPUPã€YueMengç­‰å¤šä¸ªåˆä½œä¼™ä¼´
- **ğŸš€ æ€§èƒ½ä¼˜åŒ–**: æ”¯æŒåŒæ­¥/å¼‚æ­¥æ¨¡å¼åˆ‡æ¢ï¼Œå†…ç½®æ€§èƒ½æµ‹è¯•å·¥å…·

## ğŸ—ï¸ æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Involve Asia  â”‚    â”‚  WeeklyReporter  â”‚    â”‚   è¾“å‡ºæ¸ é“      â”‚
â”‚      API        â”‚â”€â”€â”€â–¶â”‚    å¤„ç†å¼•æ“      â”‚â”€â”€â”€â–¶â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â€¢ Excelæ–‡ä»¶     â”‚
        â”‚                        â”‚              â”‚ â€¢ é‚®ä»¶å‘é€     â”‚
        â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â€¢ é£ä¹¦ä¸Šä¼      â”‚
        â”‚              â”‚  Async I/O Core  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚              â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â–²
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ â”‚ httpx+asyncio  â”‚           â”‚
         å¹¶å‘åˆ†é¡µè¯·æ±‚    â”‚ â”‚ è¿æ¥æ± å¤ç”¨     â”‚           â”‚
                        â”‚ â”‚ æ™ºèƒ½é‡è¯•æœºåˆ¶   â”‚           â”‚
                        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
                                â”‚                     â”‚
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
                       â”‚  Cloud Scheduler â”‚           â”‚
                       â”‚    å®šæ—¶ä»»åŠ¡      â”‚           â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
                                â”‚                     â”‚
                                â–¼                     â”‚
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
                       â”‚   Google Cloud   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚      Run         â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒè¦æ±‚

- Python 3.11+
- pandas >= 1.5.0
- openpyxl >= 3.0.0
- requests >= 2.28.0
- httpx >= 0.25.0 (å¼‚æ­¥I/Oæ”¯æŒ)
- psutil >= 5.9.0 (èµ„æºç›‘æ§)

### 2. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### 3. é…ç½®è®¾ç½®

ç¼–è¾‘ `config.py` æ–‡ä»¶ï¼Œè®¾ç½®å¿…è¦çš„APIå¯†é’¥å’Œé…ç½®ï¼š

```python
# APIé…ç½®
INVOLVE_ASIA_API_SECRET = "your_api_secret"
INVOLVE_ASIA_API_KEY = "general"

# Partneré…ç½®
PARTNER_SOURCES_MAPPING = {
    "RAMPUP": {
        "sources": ["RAMPUP"],
        "pattern": r"^(RAMPUP|RPID.*)",
        "email_enabled": True,
        "email_recipients": ["example@example.com"]
    }
}

# å¼‚æ­¥I/Oé…ç½® (å¯é€‰)
MAX_CONCURRENT_REQUESTS = 5  # æœ€å¤§å¹¶å‘è¯·æ±‚æ•°
USE_ASYNC_API = True         # é»˜è®¤å¯ç”¨å¼‚æ­¥æ¨¡å¼
```

### 4. è¿è¡Œç¨‹åº

```bash
# è¿è¡Œå®Œæ•´å·¥ä½œæµ
python main.py

# åªå¤„ç†ç‰¹å®šPartner
python main.py --partner RAMPUP,YueMeng

# æŒ‡å®šæ—¥æœŸèŒƒå›´
python main.py --start-date 2025-06-17 --end-date 2025-06-18

# ä½¿ç”¨å¼‚æ­¥æ¨¡å¼æå‡æ€§èƒ½
python main.py --async

# è®¾ç½®å¼‚æ­¥å¹¶å‘æ•°
python main.py --async --concurrent 10

# æ‰§è¡Œæ€§èƒ½æµ‹è¯•
python main.py --performance-test

# ç»„åˆä½¿ç”¨å¼‚æ­¥å’Œå…¶ä»–å‚æ•°
python main.py --async --partner ByteC --days-ago 1
```

## ğŸ“… å®šæ—¶ä»»åŠ¡

### Cloud Scheduleré…ç½®

é¡¹ç›®æ”¯æŒGoogle Cloud Schedulerè¿›è¡Œå®šæ—¶ä»»åŠ¡ï¼š

```bash
# è®¾ç½®æ¯æ—¥ä¸‹åˆ4ç‚¹è¿è¡Œ
./setup_cloud_scheduler_4pm.sh

# æµ‹è¯•å®šæ—¶ä»»åŠ¡
./test_scheduler_4pm.sh
```

### æœ¬åœ°è°ƒåº¦å™¨

```bash
# å¯åŠ¨æœ¬åœ°å®šæ—¶ä»»åŠ¡
python main.py --start-scheduler
```

## ğŸ“Š Partneré…ç½®

ç³»ç»Ÿæ”¯æŒå¤šä¸ªPartnerçš„ç‹¬ç«‹å¤„ç†ï¼š

- **RAMPUP**: RAMPUPã€RPIDå¼€å¤´çš„sources
- **YueMeng**: OPPOã€VIVOã€OEM2ã€OEM3 sources
- **TestPartner**: æµ‹è¯•ç”¨é€”

æ¯ä¸ªPartnerå¯ä»¥ç‹¬ç«‹é…ç½®ï¼š
- é‚®ä»¶å‘é€å¼€å…³
- æ”¶ä»¶äººåˆ—è¡¨
- æ•°æ®è¿‡æ»¤è§„åˆ™

## ğŸ”§ éƒ¨ç½²é€‰é¡¹

### 1. Google Cloud Run

```bash
# è‡ªåŠ¨éƒ¨ç½² (æ¨è)
git push origin main  # è§¦å‘GitHub Actionsè‡ªåŠ¨éƒ¨ç½²

# æ‰‹åŠ¨éƒ¨ç½²
gcloud builds submit --config cloudbuild.yaml .
```

### 2. æœ¬åœ°è¿è¡Œ

```bash
# ç›´æ¥è¿è¡Œ
python main.py

# Dockerè¿è¡Œ
docker-compose up
```

## ğŸ“ è¾“å‡ºæ–‡ä»¶

- **ExcelæŠ¥å‘Š**: `output/PartnerName_ConversionReport_YYYY-MM-DD.xlsx`
- **JSONæ•°æ®**: `output/conversions_YYYYMMDD_HHMMSS.json`
- **æ—¥å¿—æ–‡ä»¶**: æ§åˆ¶å°è¾“å‡ºå’ŒCloud Logging

## ğŸ› ï¸ é«˜çº§åŠŸèƒ½

### å¼‚æ­¥I/Oæ€§èƒ½ä¼˜åŒ–

ç³»ç»Ÿé›†æˆäº†åŸºäº `httpx` å’Œ `asyncio` çš„å¼‚æ­¥APIå®¢æˆ·ç«¯ï¼š

**ç‰¹æ€§ä¼˜åŠ¿**:
- **å¹¶å‘åˆ†é¡µè¯·æ±‚**: åŒæ—¶å¤„ç†å¤šä¸ªAPIé¡µé¢ï¼Œæ˜¾è‘—å‡å°‘æ€»è€—æ—¶
- **æ™ºèƒ½å¹¶å‘æ§åˆ¶**: é»˜è®¤5ä¸ªå¹¶å‘è¯·æ±‚ï¼Œå¯é€šè¿‡ `--concurrent` è°ƒæ•´
- **è¿æ¥æ± å¤ç”¨**: ä¼˜åŒ–HTTPè¿æ¥ç®¡ç†ï¼Œå‡å°‘æ¡æ‰‹å¼€é”€
- **æ‰¹æ¬¡å¤„ç†**: å¤§æ•°æ®é‡æ—¶åˆ†æ‰¹å¹¶å‘å¤„ç†ï¼Œé¿å…å†…å­˜æº¢å‡º
- **æ€§èƒ½ç›‘æ§**: å†…ç½®èµ„æºä½¿ç”¨ç›‘æ§å’Œæ€§èƒ½å¯¹æ¯”å·¥å…·

**ä½¿ç”¨æ–¹å¼**:
```bash
# å¯ç”¨å¼‚æ­¥æ¨¡å¼ï¼ˆæ¨èç”¨äºå¤§æ•°æ®é‡ï¼‰
python main.py --async

# è‡ªå®šä¹‰å¹¶å‘æ•°
python main.py --async --concurrent 8

# æ€§èƒ½æµ‹è¯•å¯¹æ¯”
python main.py --performance-test

# å¼ºåˆ¶ä½¿ç”¨åŒæ­¥æ¨¡å¼
python main.py --sync
```

**é…ç½®é€‰é¡¹**:
- `MAX_CONCURRENT_REQUESTS`: æœ€å¤§å¹¶å‘è¯·æ±‚æ•° (é»˜è®¤: 5)
- `USE_ASYNC_API`: ç¯å¢ƒå˜é‡æ§åˆ¶é»˜è®¤æ¨¡å¼ (true/false)
- `ASYNC_BATCH_SIZE`: æ‰¹æ¬¡å¤„ç†å¤§å° (é»˜è®¤: 10)

### APIç«¯ç‚¹

å½“éƒ¨ç½²åˆ°Cloud Runæ—¶ï¼Œæä¾›ä»¥ä¸‹HTTPç«¯ç‚¹ï¼š

- `GET /health` - å¥åº·æ£€æŸ¥
- `GET /status` - æœåŠ¡çŠ¶æ€
- `POST /run` - è§¦å‘æŠ¥å‘Šç”Ÿæˆ

### é‚®ä»¶æ¨¡æ¿

æ”¯æŒè‡ªå®šä¹‰HTMLé‚®ä»¶æ¨¡æ¿ï¼ŒåŒ…å«ï¼š
- Partnerä¸“å±å†…å®¹
- æ•°æ®æ±‡æ€»è¡¨æ ¼
- é£ä¹¦é“¾æ¥ï¼ˆå¯é€‰ï¼‰

### é£ä¹¦é›†æˆ

- è‡ªåŠ¨ä¸Šä¼ Excelæ–‡ä»¶åˆ°æŒ‡å®šæ–‡ä»¶å¤¹
- æ”¯æŒå¤§æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ 
- è‡ªåŠ¨è·å–è®¿é—®token

## ğŸ” ç›‘æ§å’Œè°ƒè¯•

### æŸ¥çœ‹æ—¥å¿—

```bash
# Cloud Runæ—¥å¿—
gcloud logs read --limit=50 \
  --filter='resource.type="cloud_run_revision"'

# Scheduleræ—¥å¿—
gcloud logs read --limit=20 \
  --filter='resource.type="cloud_scheduler_job"'
```

### æµ‹è¯•è¿æ¥

```bash
# æµ‹è¯•é£ä¹¦è¿æ¥
python main.py --test-feishu

# æµ‹è¯•é‚®ä»¶è¿æ¥
python main.py --test-email

# å¼‚æ­¥APIåŠŸèƒ½æµ‹è¯•
python test_async_api.py

# åŒæ­¥vså¼‚æ­¥æ€§èƒ½å¯¹æ¯”
python main.py --performance-test
```

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š

1. [éƒ¨ç½²æŒ‡å—](GCP_DEPLOYMENT.md)
2. [é‚®ä»¶è®¾ç½®](EMAIL_SETUP_README.md)
3. [é£ä¹¦é…ç½®](FEISHU_UPLOAD_README.md)
4. [è°ƒåº¦å™¨è®¾ç½®](SCHEDULER_SETUP_GUIDE.md)

## ğŸ”„ ç‰ˆæœ¬æ›´æ–°

### v2.1.0 (2025-01-24) - å¼‚æ­¥I/Oå¢å¼º
- âœ¨ **æ–°å¢å¼‚æ­¥APIæ”¯æŒ**: åŸºäºhttpxå’Œasyncioçš„é«˜æ€§èƒ½æ•°æ®è·å–
- âš¡ **æ€§èƒ½å¤§å¹…æå‡**: å¹¶å‘åˆ†é¡µè¯·æ±‚ï¼Œå¤§å¹…å‡å°‘APIè°ƒç”¨è€—æ—¶
- ğŸ› ï¸ **æ–°å¢å‘½ä»¤è¡Œå‚æ•°**: --async, --sync, --concurrent, --performance-test
- ğŸ“Š **æ€§èƒ½ç›‘æ§å·¥å…·**: å†…ç½®åŒæ­¥vså¼‚æ­¥æ€§èƒ½å¯¹æ¯”åŠŸèƒ½
- ğŸ”§ **æ™ºèƒ½å¹¶å‘æ§åˆ¶**: è‡ªé€‚åº”å¹¶å‘æ•°é…ç½®ï¼Œå¯åŠ¨æ€è°ƒæ•´
- ğŸ”„ **å®Œå…¨å‘åå…¼å®¹**: ä¿æŒæ‰€æœ‰ç°æœ‰åŠŸèƒ½ä¸å˜ï¼Œæ— ç¼å‡çº§

### v2.0.0 (2025-06-20) - å¤šPartneræ”¯æŒ
- ğŸ¯ å¤šPartnerç‹¬ç«‹å¤„ç†å’Œé‚®ä»¶å‘é€
- â° Cloud Schedulerå®šæ—¶ä»»åŠ¡é›†æˆ
- â˜ï¸ é£ä¹¦è‡ªåŠ¨ä¸Šä¼ åŠŸèƒ½

---

**Last Updated**: 2025-01-24  
**Version**: 2.1.0  
**Cloud Scheduler**: âœ… Daily 4PM for RAMPUP & YueMeng partners  
**Async I/O**: âœ… High-performance concurrent API requests 